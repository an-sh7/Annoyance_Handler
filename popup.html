<!DOCTYPE html>
<html>
<head>
  <title>Enhanced Ad Blocker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; width: 200px; }
    h1 { font-size: 16px; }
    button { padding: 5px 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Enhanced Ad Blocker</h1>
  <p>Status: <span id="status">Active</span></p>
  <button id="toggleBtn">Disable Ad Blocking</button>
  <script src="rules.js"></script>
  <script>
    // On load, update the UI based on stored settings
    document.addEventListener('DOMContentLoaded', () => {
      chrome.storage.sync.get({ adBlockEnabled: true }, (data) => {
        updatePopupUI(data.adBlockEnabled);
      });
    });

    // Toggle ad blocking when the button is clicked
    document.getElementById('toggleBtn').addEventListener('click', () => {
      chrome.storage.sync.get({ adBlockEnabled: true, ruleSettings: { "1": true, "2": true } }, (data) => {
        let newStatus = !data.adBlockEnabled;
        chrome.storage.sync.set({ adBlockEnabled: newStatus }, () => {
          // Update dynamic rules based on new global status and stored rule settings
          let newRules = [];
          if (newStatus) {
            newRules = defaultRules.filter(rule => data.ruleSettings[rule.id]);
          }
          chrome.runtime.sendMessage({ type: 'updateRules', rules: newRules }, (response) => {
            if (response.status === 'success') {
              updatePopupUI(newStatus);
            }
          });
        });
      });
    });

    function updatePopupUI(enabled) {
      document.getElementById('status').textContent = enabled ? 'Active' : 'Paused';
      document.getElementById('toggleBtn').textContent = enabled ? 'Disable Ad Blocking' : 'Enable Ad Blocking';
    }
  </script>
</body>
</html>
